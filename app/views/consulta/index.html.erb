<div class="card overflow-hidden chat-application">
  <div class="d-flex w-100">
    <div class="left-part border-end w-20 flex-shrink-0 d-none d-lg-block">
      <div class="container">
    </div>
      <div class="container">
      <img
      src="https://img.freepik.com/vetores-gratis/ilustracao-do-conceito-de-equipe-de-profissionais-de-saude_114360-1608.jpg?t=st=1718921666~exp=1718925266~hmac=36bea393b14581f783e9854e5078b651bdef954b64e6b7ce1ab5109819b89389&w=826"
      alt="homepage"
      width="300"
      class="dark-logo"
    />
  </div>
      <div class="px-9 pt-4 pb-3">
      <%= button_to new_consultum_path, method: :get, class: "btn btn-success fw-semibold py-8 w-100", style: "background-color: #04DFC0;" do %>
      <i class="fas fa-plus-circle me-2"></i> Nova Consulta
    <% end %>
  </div>
  <%= search_form_for @q, url: consulta_path, method: :get, html: { id: 'search_form' } do |f| %>
      <ul class="list-group" style="height: calc(100vh - 400px)" data-simplebar="init"><div class="simplebar-wrapper" style="margin: 0px;"><div class="simplebar-height-auto-observer-wrapper"><div class="simplebar-height-auto-observer"></div></div><div class="simplebar-mask"><div class="simplebar-offset" style="right: 0px; bottom: 0px;"><div class="simplebar-content-wrapper" tabindex="0" role="region" aria-label="scrollable content" style="height: 100%; overflow: hidden;"><div class="simplebar-content" style="padding: 0px;">
        <li class="list-group-item border-0 p-0 mx-9">
          <a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-8 mb-1 rounded-1" href="javascript:void(0)">
            <i class="ti ti-calendar fs-5"></i>Todas as Consultas </a>
        </li>
        <li class="list-group-item border-0 p-0 mx-9">
          <a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-8 mb-1 rounded-1" href="javascript:void(0)">
            <i class="ti ti-star"></i>Consultas Ativas</a>
        </li>
        <li class="list-group-item border-0 p-0 mx-9">
          <a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-8 mb-1 rounded-1" href="javascript:void(0)">
            <i class="ti ti-file-text fs-5"></i>Consultas Pendentes </a>
        </li>
        <li class="list-group-item border-0 p-0 mx-9">
          <a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-8 mb-1 rounded-1" href="javascript:void(0)">
            <i class="ti ti-alert-circle"></i>Consultas Fechadas</a>
        </li>
        <li class="border-bottom my-3"></li>
        <li class="fw-semibold text-dark text-uppercase mx-9 my-2 px-3 fs-2">FILTRAR POR</li>
        <li class="list-group-item border-0 p-0 mx-9">
            <%= f.hidden_field :medico_id_eq, id: "medico_id_field" %>
            <a href="#" data-bs-toggle="modal" data-bs-target="#medicoModal" class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-8 mb-1 rounded-1">
              <img src="https://cdn-icons-png.flaticon.com/128/3762/3762767.png" width="40" height="40" class="mb-6 mx-auto" alt="">
              <h6>Médico</h6> 
            </a>
        </li>
        <li class="list-group-item border-0 p-0 mx-9">
          <a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-8 mb-1 rounded-1" href="javascript:void(0)">
            <i class="ti ti-bookmark fs-5 text-warning"></i>Paciente</a>
        </li>
        <li class="list-group-item border-0 p-0 mx-9">
          <a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-8 mb-1 rounded-1" href="javascript:void(0)">
            <i class="ti ti-bookmark fs-5 text-success"></i>Sales Team </a>
        </li>
      </div></div></div></div><div class="simplebar-placeholder" style="width: 228px; height: 370px;"></div></div><div class="simplebar-track simplebar-horizontal" style="visibility: hidden;"><div class="simplebar-scrollbar" style="width: 0px; display: none;"></div></div><div class="simplebar-track simplebar-vertical" style="visibility: hidden;"><div class="simplebar-scrollbar" style="height: 0px; display: none;"></div></div></ul>
    </div>


    <!-- Modalmedico -->
  <div class="modal fade" id="medicoModal" tabindex="-1" aria-labelledby="medicoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="medicoModalLabel">Selecione um Médico</h5>
          <div class="d-flex justify-content-end flex-grow-1">
            <%= link_to home_path, class: 'btn btn-primary btn-sm' do %>
              <i class="fas fa-eraser"></i> Limpar busca
            <% end %>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="py-2">
            <ul class="list-style-none chat-list">
            <% @medicos.each do |medico| %>
              <li class="mb-4">
                <a href="javascript:void(0)">
                  <div href="#" class="select-medico d-flex align-items-center" data-id="<%= medico.id %>">
                    <img src="user-06.jpg" class="rounded round-50">
                    <div class="ms-3">
                      <h6 class="select-medico" href="#" class="select-medico" data-id="<%= medico.id %>"><%= medico.nome %></h6>
                      <small class="text-success">Online</small>
                    </div>
                  </div>
                </a>
              </li>
              <% end %>                        
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal -->

    <div class="d-flex w-100">
      <div class="min-width-493">
        <div class="border-end user-chat-box h-100">
          <div class="px-4 pt-9 pb-6 d-none d-lg-block">
            <h4 class="card-title">Área de Busca</h4>
            <div class="row">
              <div class="col-5">
                <label for="q_data_consulta_gteq">Data da Consulta (De)</label>
                <%= f.date_field :data_consulta_gteq, class: "form-control" %>
              </div>
              <div class="col-5">
                <label for="q_data_consulta_lteq">Data da Consulta (Até)</label>
                <%= f.date_field :data_consulta_lteq, class: "form-control" %>
              </div>
              <div class="col-2">
                <%= button_tag(type: 'submit', class: 'btn btn-primary mt-4') do %>
                  <i class="fas fa-search"></i> <!-- Adicione o ícone de busca aqui (Bootstrap Icons) -->
                <% end %>
              </div>
            </div>
          <% end %>
          

          
          

            
          </div>
          <div class="app-chat">
            <div class="d-flex align-items-center">
              <h3 class="px-9 py-4 mb-0">Consultas</h3>
              <span class="badge bg-info-subtle text-info rounded fw-semibold "> <i class="fas fa-info-circle me-1"></i>Selecione a Consulta que deseja detalhar</span>
          </div>
          
            <div class="card-header" style="background-color: white;">
              <table style="width: 100%;">
                <tr>
                  <td style="text-align: left;"><h6>Paciente</h6></td>
                  <td style="text-align: center;"><h6 style=" margin-left: -29px !important;">Data e Hora</h6></td>
                  <td style="text-align: right;"><h6>Médico</h6></td>
                </tr>
              </table>
            </div>
            
              <div class="card-body">

                <!-- ============================================================== -->
                <!-- Comment widgets -->
                <!-- ============================================================== -->
                <div class="comment-widgets position-relative mb-2 simplebar-scrollable-y" data-simplebar="init" style="height: 660px"><div class="simplebar-wrapper" style="margin: 0px;"><div class="simplebar-height-auto-observer-wrapper"><div class="simplebar-height-auto-observer"></div></div><div class="simplebar-mask"><div class="simplebar-offset" style="right: 0px; bottom: 0px;"><div class="simplebar-content-wrapper" tabindex="0" role="region" aria-label="scrollable content" style="height: 100%; overflow: hidden scroll;"><div class="simplebar-content" style="padding: 0px;">
                  <!-- Comment Row -->
                  
                  <% @consultas.each do |f| %>
                  <div class="d-flex gap-3 comment-row mb-5">
                    <span class="flex-shrink-0">
                      <div class="d-flex align-items-center gap-3 mb-4">
                        <h5 class="me-1"><%= f.id  %></h5>
                        <img src="/user-05.jpg" alt="user" width="56" height="56" class="rounded round-50">
                        <h5 ><%= f.paciente.nome  %></h5>
                      </div>
                     
                    </span>
                    <div class="comment-text flex-grow-1 position-relative">
                      <div class="d-flex justify-content-between align-items-center mb-1 position-relative">
                        <div class="d-flex align-items-center gap-3">                       
                          <span class="badge bg-success-subtle text-success rounded fw-semibold p-2 date-center">
                            <%= formatar_data_hora_minuto(f.data_consulta) %>
                          </span>
                        </div>
                
                        <div class="d-flex align-items-center gap-3 mb-9">
                          <h5 class="mb-0">Dr.<%= f.medico.nome %></h5>
                          <img width="56" height="56" class="rounded round-50" src="/user-06.jpg" alt="user" data-bs-toggle="tooltip" data-bs-placement="top" title="" data-original-title="Priyanka">
                        </div>
                      </div>
                
                    
                    </div>
                    <!-- Linha vertical -->
                    <div class="vertical-line"></div>
                  </div>
                  
                <% end %>
                
                
                <style>
                  .comment-row {
                    display: flex !important;
                    align-items: flex-start !important;
                    gap: 1rem !important;
                    position: relative !important;
                  }
                
                  .comment-text {
                    display: flex !important;
                    flex-direction: column !important;
                    width: 100% !important;
                    position: relative !important;
                  }
                
                  .d-flex {
                    display: flex !important;
                    align-items: center !important;
                  }
                
                  .gap-3 {
                    gap: 1rem !important;
                  }
                
                  .mb-1 {
                    margin-bottom: 0.25rem !important;
                  }
                
                  .mb-5 {
                    margin-bottom: 1.25rem !important;
                  }
                
                  .align-items-center {
                    align-items: center !important;
                  }
                
                  .justify-content-between {
                    justify-content: space-between !important;
                  }
                
                  .badge {
                    display: inline-block !important;
                    vertical-align: middle !important;
                  }
                
                  .truncate-2 {
                    display: -webkit-box !important;
                    -webkit-line-clamp: 2 !important;
                    -webkit-box-orient: vertical !important;
                    overflow: hidden !important;
                  }
                
                  .me-1 {
                    margin-right: 0.25rem !important;
                  }
                
                  .vertical-line {
                       position: absolute !important;
                        left: 50% !important;
                        top: 0 !important;
                        bottom: -25px !important;
                        border-left: 2px solid #ccc !important;
                        transform: translateX(-50%) !important;
                        z-index: -1 !important;
                  }
                
                  .date-center {
                       position: absolute !important;
                      left: 28% !important;
                      transform: translateX(-50%) !important;
                      white-space: nowrap !important;
                  }
                </style>
                
                
                
                    
                </div></div></div></div><div class="simplebar-placeholder" style="width: 512px; height: 624px;"></div></div><div class="simplebar-track simplebar-horizontal" style="visibility: hidden;"><div class="simplebar-scrollbar" style="width: 0px; display: none;"></div></div><div class="simplebar-track simplebar-vertical" style="visibility: visible;"><div class="simplebar-scrollbar" style="height: 361px; transform: translate3d(0px, 0px, 0px); display: block;"></div></div></div>
              </div>
            </div>
        </div>
      </div>
      <div class="w-100" style="margin-top: -354px;">
        <div class="chat-container h-100 w-100">
          <div class="chat-box-inner-part h-100">
            <div class="chatting-box app-email-chatting-box">
              <div class="p-9 py-3 border-bottom chat-meta-user d-flex align-items-center justify-content-between chat-active">
                <h5 class="text-dark mb-0 fs-5">Detalhes da Consulta</h5>
                <ul class="list-unstyled mb-0 d-flex align-items-center">
                  <li class="d-lg-none d-block">
                    <a class="text-dark back-btn px-2 fs-5 bg-hover-primary nav-icon-hover position-relative z-index-5" href="javascript:void(0)">
                      <i class="ti ti-arrow-left"></i>
                    </a>
                  </li>
                  <li class="position-relative" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="important">
                    <a class="text-dark px-2 fs-5 bg-hover-primary nav-icon-hover position-relative z-index-5" href="javascript:void(0)">
                      <i class="ti ti-star"></i>
                    </a>
                  </li>
                  <li class="position-relative" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Edit">
                    <a class="d-block text-dark px-2 fs-5 bg-hover-primary nav-icon-hover position-relative z-index-5" href="javascript:void(0)">
                      <i class="ti ti-pencil"></i>
                    </a>
                  </li>
                  <li class="position-relative" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Delete">
                    <a class="text-dark px-2 fs-5 bg-hover-primary nav-icon-hover position-relative z-index-5" href="javascript:void(0)">
                      <i class="ti ti-trash"></i>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="position-relative overflow-hidden">
                <div class="position-relative">
                  <div class="chat-box p-9" style="height: calc(100vh - 428px)" data-simplebar="init">
                    <div class="simplebar-wrapper" style="margin: -20px;">
                      <div class="simplebar-height-auto-observer-wrapper">
                        <div class="simplebar-height-auto-observer"></div>
                      </div>
                      <div class="simplebar-mask">
                        <div class="simplebar-offset" style="right: 0px; bottom: 0px;">
                          <div class="simplebar-content-wrapper" tabindex="0" role="region" aria-label="scrollable content" style="height: 100%; overflow: hidden scroll;">
                            <div class="simplebar-content" style="padding: 20px;">
                              <div class="chat-list chat active-chat" data-user-id="1">
                                <div class="hstack align-items-start mb-7 pb-1 align-items-center justify-content-between">
                                  <div class="d-flex align-items-center gap-3">
                                    <img src="/user-05.jpg" alt="user4" width="72" height="72" class="rounded-circle">
                                    <div>
                                      <h6 class="fw-semibold fs-4 mb-0">Dr. Boris Brejka</h6>
                                      <p class="mb-0">05248685205</p>
                                    </div>
                                  </div>
                                </div>
                                <div class="row">
                                  <div class="col-4 mb-7">
                                    <p class="mb-1 fs-2">Data da Consulta</p>
                                    <h6 class="fw-semibold mb-0">Dia 18 de maio</h6>
                                  </div>
                                  <div class="col-8 mb-7">
                                    <p class="mb-1 fs-2">Status</p>
                                    <h6 class="fw-semibold mb-0">ativo</h6>
                                  </div>
                                  <div class="col-12 mb-9">
                                    <p class="mb-1 fs-2">Tipo</p>
                                    <h6 class="fw-semibold mb-0">312, Imperical Arc, New western corner</h6>
                                  </div>
                                
                                </div>
                                <div class="border-bottom pb-7 mb-4">
                                  <p class="mb-2 fs-2">Ficha</p>
                                  <p class="mb-3 text-dark">
                                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque bibendum
                                    hendrerit lobortis. Nullam ut lacus eros. Sed at luctus urna, eu fermentum
                                    diam.
                                    In et tristique mauris.
                                  </p>
                                  <p class="mb-0 text-dark">Ut id ornare metus, sed auctor enim. Pellentesque
                                    nisi magna, laoreet a augue eget, tempor volutpat diam.</p>
                                </div>
                                <div class="d-flex align-items-center gap-6">
                                  <button class="btn btn-info fs-2" fdprocessedid="pk6kl8">Editar</button>
                                  <button class="btn btn-success fs-2" fdprocessedid="83zpb">+ Nova Consulta a partir dessa</button>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="simplebar-placeholder" style="width: auto; height: 578px;"></div>
                    </div>
                    <div class="simplebar-track simplebar-horizontal" style="visibility: hidden;">
                      <div class="simplebar-scrollbar" style="width: 0px; display: none;"></div>
                    </div>
                    <div class="simplebar-track simplebar-vertical" style="visibility: visible;">
                      <div class="simplebar-scrollbar" style="height: 128px; transform: translate3d(0px, 0px, 0px); display: block;"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function openFichaModal(element) {
    var pacienteNome = element.getAttribute('data-consulta-paciente');
    var pacienteFicha = element.getAttribute('data-consulta-ficha');
    var consultaFicha = element.getAttribute('data-consulta-consulta-ficha');
  
    document.getElementById('modalPacienteNome').innerText = pacienteNome;
    document.getElementById('modalPacienteFicha').innerText = pacienteFicha;
    document.getElementById('modalConsultaFicha').innerText = consultaFicha;
  
    var fichaModal = new bootstrap.Modal(document.getElementById('fichaModal'));
    fichaModal.show();
  }
  
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".select-medico").forEach(function (element) {
      element.addEventListener("click", function (event) {
        event.preventDefault();
        var medicoId = this.getAttribute("data-id");
        var medicoNome = this.textContent;
        document.getElementById("medico_id_field").value = medicoId;
        var modal = bootstrap.Modal.getInstance(document.getElementById("medicoModal"));
        modal.hide();
  
        // Submit the form via AJAX
        document.getElementById('search_form').submit();
      });
    });
  
    // Remover manualmente o backdrop quando o modal é fechado
    var fichaModalElement = document.getElementById('fichaModal');
    fichaModalElement.addEventListener('hidden.bs.modal', function () {
      document.body.classList.remove('modal-open');
      var modals = document.querySelectorAll('.modal-backdrop');
      modals.forEach(function (modal) {
        modal.remove();
      });
    });
  });
  document.addEventListener("DOMContentLoaded", function() {
      const reorderButton = document.getElementById("reorder-button");
      const hiddenField = document.querySelector('input[name="q[s]"]');
  
      reorderButton.addEventListener("click", function() {
        if (hiddenField.value === 'created_at desc') {
          hiddenField.value = 'data_consulta asc';
        } else {
          hiddenField.value = 'created_at desc';
        }
        document.getElementById('search_form').submit();
      });
    });
  </script>